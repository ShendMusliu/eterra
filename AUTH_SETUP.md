# Authentication Setup Guide

## Current Setup (Cognito)

Authentication now goes through **Amazon Cognito** via Amplify Gen 2. The client loads `amplify_outputs.json` at
runtime to configure the User Pool client. The legacy mock auth is kept for reference only and is no longer used.

## File Structure

```
src/
  contexts/           AuthContext.tsx        # Authentication context provider
  lib/                mockAuth.ts (legacy)   # Mock auth service (unused now)
  pages/              LoginPage.tsx          # Login UI
                      SignUpPage.tsx         # Sign up UI
                      DashboardPage.tsx      # Protected dashboard
  components/         ProtectedRoute.tsx     # Route protection wrapper
  components/ui/      shadcn/ui components
amplify/
  backend.ts          Amplify Gen 2 backend config
  auth/resource.ts    Auth resource definition
public/
  amplify_outputs.json (generated by ampx; required at runtime)
```

## Deploying to AWS Amplify Gen 2

1) Start an Amplify Sandbox to create Cognito resources and generate outputs:

```bash
npm run amplify:sandbox
```

This deploys a temporary AWS environment, creates a User Pool and client, and writes `amplify_outputs.json`.

2) Make the outputs available to the client (Vite copies everything in `public/` to the final build):

```bash
cp amplify_outputs.json public/amplify_outputs.json
```

3) Run the app. The AuthContext will automatically configure Amplify from that file.

4) Deploy to production:

```bash
# Connect your repo to Amplify Console
npm run amplify:deploy
```

## Environment Configuration

- `public/amplify_outputs.json` must exist locally and in build artifacts so the browser can configure Cognito.
- If the file is missing, the UI will show an error and block sign-in/sign-up until the config is provided.

## Adding More Auth Features

The Amplify backend supports:

- Email/password authentication (configured)
- Social sign-in (Google, Facebook, etc.)
- Multi-factor authentication (MFA)
- Password recovery
- Email verification

Edit `amplify/auth/resource.ts` to enable these features.

## Security Notes

- Keep `amplify_outputs.json` out of source control; generate it per environment.
- Remove the legacy mock auth before shipping if you no longer need a sandbox mode.

## Resources

- [AWS Amplify Gen 2 Docs](https://docs.amplify.aws/gen2/)
- [Amplify Auth Guide](https://docs.amplify.aws/gen2/build-a-backend/auth/)
- [shadcn/ui Components](https://ui.shadcn.com)
